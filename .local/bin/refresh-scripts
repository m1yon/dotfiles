#!/bin/bash

# Configuration
SRC_DIR="$HOME/.local/scripts"
BIN_DIR="$HOME/.local/scripts/bin"

# Ensure directories exist
mkdir -p "$SRC_DIR"
mkdir -p "$BIN_DIR"

# --- CLEAR BIN FOLDER ---
# This removes all files/links in the bin folder to prevent orphaned commands.
# glob prevents error if dir is empty
echo "Cleaning $BIN_DIR..."
rm -rf "${BIN_DIR:?}"/*

echo "Syncing scripts from $SRC_DIR to $BIN_DIR..."

for file in "$SRC_DIR"/*.ts; do
    # 1. Check if file exists (handles empty directory case)
    [ -e "$file" ] || continue

    filename=$(basename "$file")
    link_name="${filename%.*}" # Remove extension
    target_link="$BIN_DIR/$link_name"

    # 2. FORCE the source file to be executable
    chmod +x "$file"

    # 3. Create/Update the link
    # -s: symbolic
    # -f: force (overwrite existing link)
    ln -sf "$file" "$target_link"

    echo "âœ” Linked: $link_name -> $filename (executable)"
done

echo "Done."
